
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>CH Stock Tracker</title>
<meta name="theme-color" content="#000000">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=UnifrakturMaguntia&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=JetBrains+Mono:wght@300;400&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<style>
:root{
  --bg:#000;--card:#0c0c0c;--card2:#151515;--border:#252525;--border-h:#3a3a3a;
  --text:#ccc;--dim:#999;--dim2:#666;--white:#eee;
  --green:#30d050;--yellow:#e8b830;--red:#e84040;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{background:var(--bg);color:var(--text);font-family:'Cormorant Garamond',Georgia,serif;min-height:100dvh;overflow-x:hidden}
.gothic{font-family:'UnifrakturMaguntia',serif;font-weight:400}

/* HEADER */
.hdr{position:sticky;top:0;z-index:100;background:rgba(0,0,0,.94);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border-bottom:1px solid var(--border);padding:10px 16px;display:flex;align-items:center;justify-content:center;gap:14px}
.hdr svg{width:44px;height:44px;flex-shrink:0}
.hdr-t{text-align:center}
.hdr-name{font-family:'UnifrakturMaguntia',serif;font-size:22px;color:var(--white);letter-spacing:1px}
.hdr-sub{font-family:'JetBrains Mono',monospace;font-size:7px;letter-spacing:5px;color:var(--dim2);text-transform:uppercase;margin-top:2px}

/* TABS */
.tabs{display:flex;border-bottom:1px solid var(--border);position:sticky;top:66px;z-index:99;background:rgba(0,0,0,.96)}
.tab{flex:1;padding:14px 0;text-align:center;font-family:'UnifrakturMaguntia',serif;font-size:14px;letter-spacing:1px;color:var(--dim2);cursor:pointer;border-bottom:2px solid transparent;transition:all .3s;user-select:none}
.tab.on{color:var(--white);border-bottom-color:var(--white)}

/* PANELS */
.pnl{display:none;padding:20px 16px;max-width:540px;margin:0 auto}
.pnl.on{display:block;animation:up .35s ease}
@keyframes up{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

/* SECTIONS */
.sec{margin-bottom:26px}
.sec-lbl{font-family:'UnifrakturMaguntia',serif;font-size:13px;letter-spacing:2px;color:var(--dim);margin-bottom:10px;display:flex;align-items:center;gap:10px}
.sec-lbl::after{content:'';flex:1;height:1px;background:var(--border)}

/* SELECTS */
.row{display:flex;gap:8px}
.sw{flex:1;position:relative}
.sw select{width:100%;background:var(--card2);border:1px solid var(--border);color:var(--white);padding:14px;font-family:'Cormorant Garamond',serif;font-size:16px;appearance:none;-webkit-appearance:none;border-radius:3px;cursor:pointer}
.sw select:focus{outline:none;border-color:var(--border-h)}
.sw::after{content:'â–¾';position:absolute;right:14px;top:50%;transform:translateY(-50%);color:var(--dim);pointer-events:none}

/* DATE/TIME */
.dt-row{display:flex;gap:8px}
.dt-row input{flex:1;background:var(--card2);border:1px solid var(--border);color:var(--white);padding:14px;font-family:'JetBrains Mono',monospace;font-size:13px;border-radius:3px}
.dt-row input:focus{outline:none;border-color:var(--border-h)}
input[type="date"]::-webkit-calendar-picker-indicator,
input[type="time"]::-webkit-calendar-picker-indicator{filter:invert(1);opacity:.5}

/* MATERIAL BLOCKS */
.mat{background:var(--card2);border:1px solid var(--border);border-radius:3px;margin-bottom:10px;overflow:hidden;transition:border-color .3s}
.mat.on{border-color:var(--border-h)}
.mat-hd{display:flex;align-items:center;justify-content:space-between;padding:14px 16px}
.mat-nm{font-family:'UnifrakturMaguntia',serif;font-size:15px;color:var(--dim);transition:color .25s;letter-spacing:1px}
.mat.on .mat-nm{color:var(--white)}
.mat-lvls{display:flex;gap:5px}
.lv{padding:7px 14px;font-family:'JetBrains Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;background:transparent;border:1px solid var(--border);color:var(--dim);cursor:pointer;transition:all .2s;border-radius:3px;user-select:none}
.lv:active{transform:scale(.94)}
.lv.a-oos{border-color:var(--red);color:var(--red);background:rgba(232,64,64,.1)}
.lv.a-low{border-color:var(--yellow);color:var(--yellow);background:rgba(232,184,48,.1)}
.lv.a-good{border-color:var(--green);color:var(--green);background:rgba(48,208,80,.1)}

/* Category chips */
.mat-cats{padding:4px 16px 14px;display:none;flex-wrap:wrap;gap:7px}
.mat.on .mat-cats{display:flex;animation:up .25s ease}
.cc{padding:9px 16px;background:var(--card);border:1px solid var(--border);border-radius:3px;font-family:'Cormorant Garamond',serif;font-size:15px;color:var(--dim);cursor:pointer;transition:all .2s;user-select:none}
.cc.sel{border-color:var(--white);color:var(--white);background:rgba(255,255,255,.06)}
.cc:active{transform:scale(.96)}

/* APPAREL */
.tg-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.tg{display:flex;align-items:center;gap:10px;padding:14px 16px;background:var(--card2);border:1px solid var(--border);border-radius:3px;cursor:pointer;transition:all .2s;user-select:none}
.tg.on{border-color:var(--white);background:#1a1a1a}
.tg .ti{font-size:16px}
.tg .tl{font-family:'JetBrains Mono',monospace;font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--dim);transition:color .2s}
.tg.on .tl{color:var(--white)}

/* TEXT INPUT */
.tx{width:100%;background:var(--card2);border:1px solid var(--border);color:var(--white);padding:14px;font-family:'Cormorant Garamond',serif;font-size:16px;border-radius:3px;resize:none}
.tx::placeholder{color:#555;font-style:italic}
.tx:focus{outline:none;border-color:var(--border-h)}

/* SUBMIT */
.sub{width:100%;padding:18px;background:var(--white);color:var(--bg);border:none;font-family:'UnifrakturMaguntia',serif;font-size:16px;letter-spacing:3px;cursor:pointer;transition:all .3s;border-radius:3px;position:relative;overflow:hidden}
.sub:disabled{opacity:.3;cursor:not-allowed}
.sub::before{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent);transform:translateX(-100%);transition:transform .5s}
.sub:not(:disabled):hover::before{transform:translateX(100%)}
.sub:active:not(:disabled){transform:scale(.98)}
.sub.ok{background:var(--green);color:#000}
.sub.err{background:var(--red);color:#fff}
.xd{text-align:center;padding:14px 0;color:var(--border-h);font-size:14px;letter-spacing:10px;user-select:none}
.hint{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--dim2);margin-top:8px;letter-spacing:1px}

/* FEED */
.fb{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.fcnt{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--dim);letter-spacing:1px}
.rb{background:none;border:1px solid var(--border);color:var(--dim);padding:6px 12px;font-family:'JetBrains Mono',monospace;font-size:9px;letter-spacing:2px;cursor:pointer;border-radius:3px;transition:all .2s}
.rb:hover{border-color:var(--white);color:var(--white)}
.ff{display:flex;gap:6px;margin-bottom:16px;overflow-x:auto;padding-bottom:6px;-webkit-overflow-scrolling:touch}
.ff::-webkit-scrollbar{display:none}
.fchip{padding:8px 14px;font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:2px;text-transform:uppercase;background:transparent;border:1px solid var(--border);color:var(--dim);border-radius:3px;cursor:pointer;white-space:nowrap;transition:all .2s;flex-shrink:0}
.fchip.on{border-color:var(--white);color:var(--white)}

.fcard{background:var(--card2);border:1px solid var(--border);border-radius:3px;padding:16px;margin-bottom:10px;animation:up .4s ease}
.fcard:hover{border-color:var(--border-h)}
.fch{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px}
.fcs{font-family:'UnifrakturMaguntia',serif;font-size:14px;letter-spacing:1px;color:var(--white)}
.fctm{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--dim2);text-align:right;white-space:nowrap;line-height:1.6}
.fm{display:flex;flex-direction:column;gap:8px;margin-bottom:8px}
.fmr{display:flex;flex-direction:column;gap:3px}
.fml{display:flex;align-items:center;gap:8px}
.fmn{font-family:'JetBrains Mono',monospace;font-size:9px;letter-spacing:1px;color:var(--dim);width:50px;flex-shrink:0}
.bg{padding:3px 9px;font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:1.5px;text-transform:uppercase;border-radius:3px;border:1px solid;display:inline-block}
.bg-oos{border-color:rgba(232,64,64,.4);color:var(--red);background:rgba(232,64,64,.07)}
.bg-low{border-color:rgba(232,184,48,.4);color:var(--yellow);background:rgba(232,184,48,.07)}
.bg-good{border-color:rgba(48,208,80,.4);color:var(--green);background:rgba(48,208,80,.07)}
.fcats{display:flex;flex-wrap:wrap;gap:4px;margin-left:58px}
.fcat{padding:2px 7px;font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:.5px;color:var(--dim);border:1px solid var(--border);border-radius:3px;text-transform:capitalize}
.fap{display:flex;gap:8px;margin-top:6px}
.fap span{font-size:15px;opacity:.65}
.fnote{font-family:'Cormorant Garamond',serif;font-size:14px;font-style:italic;color:var(--text);padding:8px 12px;border-left:2px solid var(--border-h);margin-top:8px}
.empty{text-align:center;padding:50px 20px;color:var(--dim)}
.empty .eic{font-size:28px;margin-bottom:10px;opacity:.3}
.empty p{font-family:'JetBrains Mono',monospace;font-size:10px;letter-spacing:2px}
.ld{text-align:center;padding:40px}
.ld::after{content:'';display:inline-block;width:18px;height:18px;border:2px solid var(--border);border-top-color:var(--white);border-radius:50%;animation:sp .7s linear infinite}
@keyframes sp{to{transform:rotate(360deg)}}
.toast{position:fixed;bottom:28px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--white);color:var(--bg);padding:12px 24px;font-family:'UnifrakturMaguntia',serif;font-size:13px;letter-spacing:1px;border-radius:3px;z-index:1000;transition:transform .4s cubic-bezier(.34,1.56,.64,1);box-shadow:0 8px 30px rgba(0,0,0,.5)}
.toast.show{transform:translateX(-50%) translateY(0)}
.toast.te{background:var(--red);color:#fff}
::-webkit-scrollbar{width:3px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
@media(max-width:380px){.hdr-name{font-size:18px}.mat-nm{font-size:13px}.lv{padding:6px 10px;font-size:8px}.cc{padding:7px 12px;font-size:13px}}
</style>
</head>
<body>

<!-- HEADER with inline SVG logo -->
<div class="hdr">
  <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" fill="white">
    <path d="M100 16C54 16 20 52 20 96c0 28 12 52 30 68l12-14c-14-12-24-32-24-54 0-34 24-62 62-62s62 28 62 62c0 22-10 42-24 54l12 14c18-16 30-40 30-68 0-44-34-80-80-80z" stroke="white" stroke-width="5" fill="none"/>
    <rect x="38" y="156" width="22" height="5" rx="2"/>
    <rect x="46" y="148" width="5" height="22" rx="2"/>
    <rect x="140" y="156" width="22" height="5" rx="2"/>
    <rect x="148" y="148" width="5" height="22" rx="2"/>
    <rect x="94" y="62" width="12" height="56" rx="2"/>
    <rect x="76" y="78" width="48" height="12" rx="2"/>
    <circle cx="100" cy="60" r="8"/>
    <circle cx="74" cy="84" r="6"/>
    <circle cx="126" cy="84" r="6"/>
    <circle cx="100" cy="120" r="8"/>
  </svg>
  <div class="hdr-t">
    <div class="hdr-name">Chrome Hearts</div>
    <div class="hdr-sub">Stock Tracker Â· Crowdsourced</div>
  </div>
</div>

<div class="tabs">
  <div class="tab on" data-t="submit">Submit Intel</div>
  <div class="tab" data-t="feed">Live Feed</div>
</div>

<!-- SUBMIT -->
<div class="pnl on" id="p-submit">
  <div class="sec">
    <div class="sec-lbl">Location</div>
    <div class="row">
      <div class="sw"><select id="sel-reg"></select></div>
      <div class="sw"><select id="sel-sto"></select></div>
    </div>
  </div>
  <div class="sec">
    <div class="sec-lbl">Date & Time</div>
    <div class="dt-row">
      <input type="date" id="inp-date">
      <input type="time" id="inp-time">
    </div>
  </div>
  <div class="sec">
    <div class="sec-lbl">Material & Category</div>
    <div id="mat-wrap"></div>
    <div class="hint">Tap a stock level â†’ categories appear below</div>
  </div>
  <div class="sec">
    <div class="sec-lbl">Apparel & Accessories</div>
    <div class="tg-grid" id="tg-wrap">
      <div class="tg" data-k="tops"><span class="ti">ðŸ‘•</span><span class="tl">Tops</span></div>
      <div class="tg" data-k="pants"><span class="ti">ðŸ‘–</span><span class="tl">Pants</span></div>
      <div class="tg" data-k="bags"><span class="ti">ðŸ‘œ</span><span class="tl">Bags</span></div>
      <div class="tg" data-k="eyewear"><span class="ti">ðŸ•¶</span><span class="tl">Eyewear</span></div>
    </div>
  </div>
  <div class="sec">
    <div class="sec-lbl">Notes</div>
    <textarea class="tx" id="inp-note" rows="2" placeholder="e.g. Dagger pendant in 22K, Floral ring size 8â€¦"></textarea>
  </div>
  <div class="xd">âœ¦ âœ¦ âœ¦</div>
  <button class="sub" id="btn-sub">Submit Report</button>
</div>

<!-- FEED -->
<div class="pnl" id="p-feed">
  <div class="fb">
    <span class="fcnt" id="f-cnt"></span>
    <button class="rb" id="btn-ref">â†» Refresh</button>
  </div>
  <div class="ff" id="f-flt">
    <div class="fchip on" data-r="all">All</div>
    <div class="fchip" data-r="Americas">Americas</div>
    <div class="fchip" data-r="Asia">Asia</div>
    <div class="fchip" data-r="Europe">Europe</div>
  </div>
  <div id="f-list"><div class="ld"></div></div>
</div>

<div class="toast" id="toast"></div>

<script>
const SB_URL='https://jganzsgsvuzmmxklmgwq.supabase.co';
const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpnYW56c2dzdnV6bW14a2xtZ3dxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1MjY0MDQsImV4cCI6MjA4NjEwMjQwNH0.qfXOHCh13IeHVxthT1WyYxWP3zoNsmDtYPFb00DPbsY';
const sb=window.supabase.createClient(SB_URL,SB_KEY);
const TBL='ch_stock_reports';

const STORES={
  Americas:["Aspen","Honolulu","LV â€” Caesars","LV â€” Fontainebleau","LV â€” Wynn","LA â€” Robertson Blvd","Malibu","Miami","NY â€” Madison Ave","NY â€” Washington St","St. Barth"],
  Asia:["Beijing â€” Yintai","Chengdu â€” SKP","Guangzhou","Hangzhou","HK â€” Peninsula","HK â€” Prince's Bldg","Nagoya","Osaka","Seoul â€” Cheongdam","Seoul â€” Shinsegae","Shanghai â€” Reel","Singapore","Taipei","Tokyo â€” Aoyama","Tokyo â€” Ginza","Tokyo â€” Shinjuku","Tokyo â€” Roppongi"],
  Europe:["London â€” Mount St","London â€” Selfridges","Manchester","Paris"]
};
const MATS=[
  {key:'silver_925',label:'Silver 925'},
  {key:'gold_22k',label:'22K Gold'},
  {key:'gold_18k_wg',label:'18K White Gold'}
];
const CATS=['Pendant','Necklace','Chain','Bracelet','Ring','Earring'];

const S={mats:{},app:{tops:false,pants:false,bags:false,eyewear:false},feed:[],filter:'all',busy:false};
MATS.forEach(function(m){S.mats[m.key]={level:null,cats:[]};});

/* === INIT === */
(function(){
  initRegion();
  initDateTime();
  initMaterials();
  initTabs();
  initApparel();
  initSubmit();
  initFeedFilters();
  document.getElementById('btn-ref').onclick=loadFeed;
})();

function initRegion(){
  var r=document.getElementById('sel-reg');
  var s=document.getElementById('sel-sto');
  Object.keys(STORES).forEach(function(k){
    var o=document.createElement('option');o.value=k;o.textContent=k;r.appendChild(o);
  });
  function upd(){
    s.innerHTML='';
    STORES[r.value].forEach(function(k){
      var o=document.createElement('option');o.value=k;o.textContent=k;s.appendChild(o);
    });
  }
  r.onchange=upd;
  upd();
}

function initDateTime(){
  var now=new Date();
  var d=document.getElementById('inp-date');
  var t=document.getElementById('inp-time');
  var yyyy=now.getFullYear();
  var mm=String(now.getMonth()+1).padStart(2,'0');
  var dd=String(now.getDate()).padStart(2,'0');
  d.value=yyyy+'-'+mm+'-'+dd;
  var mins=Math.round(now.getMinutes()/15)*15;
  t.value=String(now.getHours()).padStart(2,'0')+':'+String(mins%60).padStart(2,'0');
}

function initMaterials(){
  var wrap=document.getElementById('mat-wrap');
  MATS.forEach(function(mat){
    var block=document.createElement('div');
    block.className='mat';
    block.id='mat-'+mat.key;

    var hd=document.createElement('div');
    hd.className='mat-hd';

    var nm=document.createElement('div');
    nm.className='mat-nm';
    nm.textContent=mat.label;
    hd.appendChild(nm);

    var lvls=document.createElement('div');
    lvls.className='mat-lvls';

    ['OOS','LOW','GOOD'].forEach(function(lv){
      var btn=document.createElement('div');
      btn.className='lv';
      btn.textContent=lv;
      btn.addEventListener('click',function(e){
        e.stopPropagation();
        var cur=S.mats[mat.key].level;
        var allBtns=lvls.querySelectorAll('.lv');
        for(var i=0;i<allBtns.length;i++) allBtns[i].className='lv';
        if(cur===lv){
          S.mats[mat.key].level=null;
          S.mats[mat.key].cats=[];
          block.classList.remove('on');
          var chips=block.querySelectorAll('.cc');
          for(var j=0;j<chips.length;j++) chips[j].classList.remove('sel');
        }else{
          S.mats[mat.key].level=lv;
          btn.classList.add('a-'+lv.toLowerCase());
          block.classList.add('on');
        }
      });
      lvls.appendChild(btn);
    });
    hd.appendChild(lvls);
    block.appendChild(hd);

    var catsDiv=document.createElement('div');
    catsDiv.className='mat-cats';
    CATS.forEach(function(cat){
      var chip=document.createElement('div');
      chip.className='cc';
      chip.textContent=cat;
      chip.addEventListener('click',function(){
        chip.classList.toggle('sel');
        var arr=S.mats[mat.key].cats;
        var val=cat.toLowerCase();
        var idx=arr.indexOf(val);
        if(idx>=0) arr.splice(idx,1);
        else arr.push(val);
      });
      catsDiv.appendChild(chip);
    });
    block.appendChild(catsDiv);
    wrap.appendChild(block);
  });
}

function initTabs(){
  var tabs=document.querySelectorAll('.tab');
  for(var i=0;i<tabs.length;i++){
    tabs[i].addEventListener('click',function(){
      var all=document.querySelectorAll('.tab');
      for(var j=0;j<all.length;j++) all[j].classList.remove('on');
      var pnls=document.querySelectorAll('.pnl');
      for(var k=0;k<pnls.length;k++) pnls[k].classList.remove('on');
      this.classList.add('on');
      document.getElementById('p-'+this.dataset.t).classList.add('on');
      if(this.dataset.t==='feed') loadFeed();
    });
  }
}

function initApparel(){
  var tgs=document.querySelectorAll('#tg-wrap .tg');
  for(var i=0;i<tgs.length;i++){
    tgs[i].addEventListener('click',function(){
      this.classList.toggle('on');
      S.app[this.dataset.k]=!S.app[this.dataset.k];
    });
  }
}

function initSubmit(){
  document.getElementById('btn-sub').addEventListener('click',async function(){
    if(S.busy) return;
    var btn=this;
    var row={
      region:document.getElementById('sel-reg').value,
      store_name:document.getElementById('sel-sto').value,
      report_date:document.getElementById('inp-date').value,
      report_time:document.getElementById('inp-time').value,
      silver_925_level:S.mats.silver_925.level||'N/A',
      silver_925_categories:S.mats.silver_925.cats,
      gold_22k_level:S.mats.gold_22k.level||'N/A',
      gold_22k_categories:S.mats.gold_22k.cats,
      gold_18k_wg_level:S.mats.gold_18k_wg.level||'N/A',
      gold_18k_wg_categories:S.mats.gold_18k_wg.cats,
      has_tops:S.app.tops,
      has_pants:S.app.pants,
      has_bags:S.app.bags,
      has_eyewear:S.app.eyewear,
      comment:document.getElementById('inp-note').value.trim()
    };
    S.busy=true;btn.disabled=true;btn.textContent='Submittingâ€¦';
    try{
      var res=await sb.from(TBL).insert([row]);
      if(res.error) throw res.error;
      btn.className='sub ok';btn.textContent='âœ¦ Intel Shared âœ¦';
      toast(row.store_name+' â€” report filed');
      resetForm();
    }catch(e){
      btn.className='sub err';btn.textContent='Failed â€” tap to retry';
      toast(e.message||'Connection error',true);
    }finally{
      S.busy=false;
      setTimeout(function(){btn.disabled=false;btn.className='sub';btn.textContent='Submit Report';},2400);
    }
  });
}

function resetForm(){
  MATS.forEach(function(m){S.mats[m.key]={level:null,cats:[]};});
  var blocks=document.querySelectorAll('.mat');
  for(var i=0;i<blocks.length;i++){
    blocks[i].classList.remove('on');
    var btns=blocks[i].querySelectorAll('.lv');for(var j=0;j<btns.length;j++) btns[j].className='lv';
    var chips=blocks[i].querySelectorAll('.cc');for(var k=0;k<chips.length;k++) chips[k].classList.remove('sel');
  }
  S.app={tops:false,pants:false,bags:false,eyewear:false};
  var tgs=document.querySelectorAll('#tg-wrap .tg');
  for(var i=0;i<tgs.length;i++) tgs[i].classList.remove('on');
  document.getElementById('inp-note').value='';
  initDateTime();
}

async function loadFeed(){
  var list=document.getElementById('f-list');
  list.innerHTML='<div class="ld"></div>';
  try{
    var res=await sb.from(TBL).select('*').order('created_at',{ascending:false}).limit(50);
    if(res.error) throw res.error;
    S.feed=res.data||[];
    renderFeed();
  }catch(e){
    list.innerHTML='<div class="empty"><div class="eic">âš </div><p>'+(e.message||'Connection error')+'</p></div>';
  }
}

function initFeedFilters(){
  var chips=document.querySelectorAll('.fchip');
  for(var i=0;i<chips.length;i++){
    chips[i].addEventListener('click',function(){
      var all=document.querySelectorAll('.fchip');
      for(var j=0;j<all.length;j++) all[j].classList.remove('on');
      this.classList.add('on');
      S.filter=this.dataset.r;
      renderFeed();
    });
  }
}

function renderFeed(){
  var list=document.getElementById('f-list');
  var cnt=document.getElementById('f-cnt');
  var data=S.filter==='all'?S.feed:S.feed.filter(function(r){return r.region===S.filter;});
  cnt.textContent=data.length+' report'+(data.length!==1?'s':'');
  if(!data.length){list.innerHTML='<div class="empty"><div class="eic">âœ¦</div><p>No reports yet</p></div>';return;}
  var html='';
  for(var i=0;i<data.length;i++){
    var r=data[i];
    var mhtml='';
    var ms=[
      {n:'925',lv:r.silver_925_level,cs:r.silver_925_categories},
      {n:'22K',lv:r.gold_22k_level,cs:r.gold_22k_categories},
      {n:'18KWG',lv:r.gold_18k_wg_level,cs:r.gold_18k_wg_categories}
    ];
    for(var m=0;m<ms.length;m++){
      if(!ms[m].lv||ms[m].lv==='N/A') continue;
      var bc='bg-'+ms[m].lv.toLowerCase();
      mhtml+='<div class="fmr"><div class="fml"><span class="fmn">'+ms[m].n+'</span><span class="bg '+bc+'">'+ms[m].lv+'</span></div>';
      if(ms[m].cs&&ms[m].cs.length){
        mhtml+='<div class="fcats">';
        for(var c=0;c<ms[m].cs.length;c++) mhtml+='<span class="fcat">'+ms[m].cs[c]+'</span>';
        mhtml+='</div>';
      }
      mhtml+='</div>';
    }
    var icons=[];
    if(r.has_tops) icons.push('ðŸ‘•');if(r.has_pants) icons.push('ðŸ‘–');
    if(r.has_bags) icons.push('ðŸ‘œ');if(r.has_eyewear) icons.push('ðŸ•¶');
    var ds='',ts=r.report_time||'';
    if(r.report_date){var dt=new Date(r.report_date+'T00:00:00');ds=dt.toLocaleDateString('en-US',{month:'short',day:'numeric'});}
    var ago='';
    if(r.created_at){var diff=Date.now()-new Date(r.created_at).getTime();var mins=Math.floor(diff/60000);
      if(mins<60) ago=mins+'m ago';else if(mins<1440) ago=Math.floor(mins/60)+'h ago';else ago=Math.floor(mins/1440)+'d ago';}
    html+='<div class="fcard" style="animation-delay:'+i*.04+'s">';
    html+='<div class="fch"><div class="fcs">'+r.store_name+'</div>';
    html+='<div class="fctm">'+ds+' '+ts+'<br><span style="opacity:.4">'+ago+'</span></div></div>';
    if(mhtml) html+='<div class="fm">'+mhtml+'</div>';
    if(icons.length){html+='<div class="fap">';for(var x=0;x<icons.length;x++) html+='<span>'+icons[x]+'</span>';html+='</div>';}
    if(r.comment) html+='<div class="fnote">"'+r.comment+'"</div>';
    html+='</div>';
  }
  list.innerHTML=html;
}

function toast(msg,err){
  var t=document.getElementById('toast');
  t.textContent=msg;t.className='toast'+(err?' te':'');
  requestAnimationFrame(function(){t.classList.add('show');});
  setTimeout(function(){t.classList.remove('show');},2400);
}
</script>
</body>
</html>
